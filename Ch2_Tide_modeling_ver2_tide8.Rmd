---
title: "Ch2_Tide_modeling_ver2_tide8"
author: "Denise Colombano"
date: "September 17, 2017"
output: html_document
---

```{r}
library(tidyr)
library(ggplot2)
library(magrittr)
library(lubridate)
library(rstan)
library(StanHeaders)
library(rethinking)
```

```{r}
# reimport data frame generated in version 1 of this file
d <- read.csv("~/GitHub/suisunmarsh/Ch2/Data_output/Ch2_Data_PIT_Counts_&_Tides_Compiled.csv")
```

# Tide8 Version #

### STEP ONE
## SPLITTAIL MODELS

# Model 1a: Tide8 (=high tide default)
```{r}
dst1a <- as.list(d[c("st", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld")])
m1a.st <- map2stan(
  alist(
    st ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg) ~ dnorm(0,10)
) , data=dst1a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m1a.st))
show(m1a.st)
#pairs(m1a.st)
#plot(m1a.st)
```

# Model 2a: Tide8 and SIN/COS MNTH
```{r}
dst2a <- as.list(d[c("st", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_mnth", "cos_mnth")])

m2a.st <- map2stan(
  alist(
    st ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_mnth + bi*cos_mnth,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi) ~ dnorm(0,10)
) , data=dst2a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m2a.st))
show(m2a.st)
#pairs(m2a.st)
#plot(m2a.st)
```

# Model 3a: Tide8 and springmag
```{r}
dst3a <- as.list(d[c("st", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "springmag")])
m3a.st <- map2stan(
  alist(
    st ~ dzipois(p, lambda),
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bs0*springmag ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bs*springmag ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bs0) ~ dnorm(0,1),
    c(a, ba, bb, bc, bd, be, bf, bg, bs) ~ dnorm(0,10)
) , data=dst3a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m3a.st))
show(m3a.st)
#pairs(m3a.st)
#plot(m3a.st)
```

# Model 4a: Tide8 and SIN/COS TOD
```{r}
dst4a <- as.list(d[c("st", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_tod", "cos_tod")])

m5a.st <- map2stan(
  alist(
    st ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth + bj0*sin_tod + bk*cos_tod,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bj*sin_tod + bk*cos_tod ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bj0, bk0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bj, bk) ~ dnorm(0,10)
) , data=dst4a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m4a.st))
show(m4a.st)
#pairs(m4a.st)
#plot(m4a.st)
```

# Model 5a: Tide8, SIN/COS mnth and SIN/COS TOD
```{r}
dst5a <- as.list(d[c("st", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_mnth", "cos_mnth", "sin_tod", "cos_tod")])

m5a.st <- map2stan(
  alist(
    st ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth + bj0*sin_tod + bk*cos_tod ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_mnth + bi*cos_mnth + bj*sin_tod + bk*cos_tod ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0, bj0, bk0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi, bj, bk) ~ dnorm(0,10)
) , data=dst5a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m5a.st))
show(m5a.st)
#pairs(m5a.st)
#plot(m5a.st)
```

# Model 6a: Tide8, SIN/COS TOD and Springmag
```{r}
dst6a <- as.list(d[c("st", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_tod", "cos_tod", "springmag")])

m6a.st <- map2stan(
  alist(
    st ~ dzipois(p,lambda),
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_tod + bi0*cos_tod + bj0*springmag ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_tod + bi*cos_tod + bj*springmag  ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0, bj0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi, bj) ~ dnorm(0,10)
) , data=dst6a, warmup=2000, iter=1e4, cores=3, chains=2)

plot(precis(m6a.st))
show(m6a.st)
#pairs(m6a.st)
#plot(m6a.st)
```


### STEP TWO
## STRIPED BASS MODELS

# Model 1a: Tide8 (=high tide default)
```{r}
dsb1a <- as.list(d[c("sb", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld")])
m1a.sb <- map2stan(
  alist(
    sb ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg) ~ dnorm(0,10)
) , data=dsb1a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m1a.sb))
show(m1a.sb)
#pairs(m1a.sb)
#plot(m1a.sb)
```

# Model 2a: Tide8 and SIN/COS MNTH
```{r}
dsb2a <- as.list(d[c("sb", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_mnth", "cos_mnth")])

m2a.sb <- map2stan(
  alist(
    sb ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_mnth + bi*cos_mnth,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi) ~ dnorm(0,10)
) , data=dsb2a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m2a.sb))
show(m2a.sb)
#pairs(m2a.sb)
#plot(m2a.sb)
```

# Model 3a: Tide8 and springmag
```{r}
dsb3a <- as.list(d[c("sb", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "springmag")])
m3a.sb <- map2stan(
  alist(
    sb ~ dzipois(p, lambda),
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bs0*springmag ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bs*springmag ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bs0) ~ dnorm(0,1),
    c(a, ba, bb, bc, bd, be, bf, bg, bs) ~ dnorm(0,10)
) , data=dsb3a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m3a.sb))
show(m3a.sb)
#pairs(m3a.sb)
#plot(m3a.sb)
```

# Model 4a: Tide8 and SIN/COS TOD
```{r}
dsb4a <- as.list(d[c("sb", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_tod", "cos_tod")])

m5a.sb <- map2stan(
  alist(
    sb ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth + bj0*sin_tod + bk*cos_tod,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bj*sin_tod + bk*cos_tod ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bj0, bk0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bj, bk) ~ dnorm(0,10)
) , data=dsb4a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m4a.sb))
show(m4a.sb)
#pairs(m4a.sb)
#plot(m4a.sb)
```

# Model 5a: Tide8, SIN/COS mnth and SIN/COS TOD
```{r}
dsb5a <- as.list(d[c("sb", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_mnth", "cos_mnth", "sin_tod", "cos_tod")])

m5a.sb <- map2stan(
  alist(
    sb ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth + bj0*sin_tod + bk*cos_tod ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_mnth + bi*cos_mnth + bj*sin_tod + bk*cos_tod ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0, bj0, bk0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi, bj, bk) ~ dnorm(0,10)
) , data=dsb5a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m5a.sb))
show(m5a.sb)
#pairs(m5a.sb)
#plot(m5a.sb)
```

# Model 6a: Tide8, SIN/COS TOD and Springmag
```{r}
dsb6a <- as.list(d[c("sb", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_tod", "cos_tod", "springmag")])

m6a.sb <- map2stan(
  alist(
    sb ~ dzipois(p,lambda),
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_tod + bi0*cos_tod + bj0*springmag ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_tod + bi*cos_tod + bj*springmag  ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0, bj0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi, bj) ~ dnorm(0,10)
) , data=dsb6a, warmup=2000, iter=1e4, cores=3, chains=2)

plot(precis(m6a.sb))
show(m6a.sb)
#pairs(m6a.sb)
#plot(m6a.sb)
```


### STEP THREE
## TULE PERCH MODELS

# Model 1a: Tide8 (=high tide default)
```{r}
dtp1a <- as.list(d[c("tp", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld")])
m1a.tp <- map2stan(
  alist(
    tp ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg) ~ dnorm(0,10)
) , data=dtp1a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m1a.tp))
show(m1a.tp)
#pairs(m1a.tp)
#plot(m1a.tp)
```

# Model 2a: Tide8 and SIN/COS MNTH
```{r}
dtp2a <- as.list(d[c("tp", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_mnth", "cos_mnth")])

m2a.tp <- map2stan(
  alist(
    tp ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_mnth + bi*cos_mnth,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi) ~ dnorm(0,10)
) , data=dtp2a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m2a.tp))
show(m2a.tp)
#pairs(m2a.tp)
#plot(m2a.tp)
```

# Model 3a: Tide8 and springmag
```{r}
dtp3a <- as.list(d[c("tp", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "springmag")])
m3a.tp <- map2stan(
  alist(
    tp ~ dzipois(p, lambda),
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bs0*springmag ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bs*springmag ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bs0) ~ dnorm(0,1),
    c(a, ba, bb, bc, bd, be, bf, bg, bs) ~ dnorm(0,10)
) , data=dtp3a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m3a.tp))
show(m3a.tp)
#pairs(m3a.tp)
#plot(m3a.tp)
```

# Model 4a: Tide8 and SIN/COS TOD
```{r}
dtp4a <- as.list(d[c("tp", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_tod", "cos_tod")])

m5a.tp <- map2stan(
  alist(
    tp ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth + bj0*sin_tod + bk*cos_tod,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bj*sin_tod + bk*cos_tod ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bj0, bk0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bj, bk) ~ dnorm(0,10)
) , data=dtp4a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m4a.tp))
show(m4a.tp)
#pairs(m4a.tp)
#plot(m4a.tp)
```

# Model 5a: Tide8, SIN/COS mnth and SIN/COS TOD
```{r}
dtp5a <- as.list(d[c("tp", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_mnth", "cos_mnth", "sin_tod", "cos_tod")])

m5a.tp <- map2stan(
  alist(
    tp ~ dzipois(p, lambda) ,
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_mnth + bi0*cos_mnth + bj0*sin_tod + bk*cos_tod ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_mnth + bi*cos_mnth + bj*sin_tod + bk*cos_tod ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0, bj0, bk0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi, bj, bk) ~ dnorm(0,10)
) , data=dtp5a, warmup=2000, iter=1e4, chains=2, cores=3)

plot(precis(m5a.tp))
show(m5a.tp)
#pairs(m5a.tp)
#plot(m5a.tp)
```

# Model 6a: Tide8, SIN/COS TOD and Springmag
```{r}
dtp6a <- as.list(d[c("tp", "low", "incfld", "decfld", "decebb", "incebb", "maxebb", "maxfld", "sin_tod", "cos_tod", "springmag")])

m6a.tp <- map2stan(
  alist(
    tp ~ dzipois(p,lambda),
    logit(p) <- a0 + ba0*low + bb0*incfld + bc0*decfld + bd0*decebb + be0*incebb + bf0*maxebb + bg0*maxfld + bh0*sin_tod + bi0*cos_tod + bj0*springmag ,
    log(lambda) <- a + ba*low + bb*incfld + bc*decfld + bd*decebb + be*incebb + bf*maxebb + bg*maxfld + bh*sin_tod + bi*cos_tod + bj*springmag  ,
    c(a0, ba0, bb0, bc0, bd0, be0, bf0, bg0, bh0, bi0, bj0) ~ dnorm(0,1) ,
    c(a, ba, bb, bc, bd, be, bf, bg, bh, bi, bj) ~ dnorm(0,10)
) , data=dtp6a, warmup=2000, iter=1e4, cores=3, chains=2)

plot(precis(m6a.tp))
show(m6a.tp)
#pairs(m6a.tp)
#plot(m6a.tp)
```

